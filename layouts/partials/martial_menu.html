<div id="martial-toc" class="martial-sidebar">
    <div class="sidebar-header">
        <input type="text" id="martialSearch" placeholder="搜尋(如:0199)..." onkeyup="doMartialSearch()">
    </div>
    <nav class="martial-nav">
        {{ range (where .Site.Sections "Section" "blog") }}
            {{ range .Sections }}
            <div class="m-tier-1">
                <div class="m-label" onclick="mToggle(this)">
                    {{ .Title }} <span class="m-count">({{ len .Pages }})</span> <span class="m-arrow">▼</span>
                </div>
                <div class="m-content">
                    <ul class="m-tier-3">
                        {{ range .Pages.ByDate.Reverse }} <li><a href="{{ .RelPermalink }}" class="martial-link">{{ .Title }}</a></li>
                        {{ end }}
                    </ul>
                </div>
            </div>
            {{ end }}
        {{ end }}
    </nav>
</div>

<style>
/* 1. 側邊欄背景：維持 0.2 透明度，看清後方文字 */
body #martial-toc.martial-sidebar { 
    position: fixed !important; right: 15px !important; top: 45px !important; 
    width: 235px !important; max-height: 85vh !important; z-index: 999999 !important; 
    background: rgba(00, 00, 00, 0.2) !important; 
    border: 1px solid rgba(0, 255, 255, 0.4) !important; 
    padding: 15px !important; border-radius: 12px !important;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5) !important;
    overflow-y: auto !important;
}

/* 2. 搜尋框樣式 */
#martialSearch { 
    width: 100%; background: rgba(0, 0, 0, 0.2); border: 2px solid #00FFFF; 
    color: #00FFFF; padding: 5px; margin-bottom: 10px; border-radius: 6px; 
    font-weight: bold;
}

/* 3. 亮青色文章連結：專為數千篇文章設計的顯眼色 */
.martial-link {
    color: #00FFFF !important; /* 亮青色 */
    text-shadow: 1px 1px 3px rgba(0,0,0,1) !important; /* 加重陰影確保在淺底也清晰 */
    text-decoration: none !important;
    font-size: 0.9em !important;
    display: block;
    padding: 4px 0;
    transition: 0.2s;
}
.martial-link:hover { color: #FFFFFF !important; background: rgba(0, 255, 255, 0.2); }

/* 4. 分類標題樣式 */
body #martial-toc .m-label { 
    color: #00CCFF !important; font-weight: 800 !important; cursor: pointer; 
    display: flex; justify-content: space-between; padding: 10px 0;
    border-bottom: 1px solid rgba(0, 255, 255, 0.2);
}

.m-content { display: none; }
.m-content.is-active { display: block !important; }
.m-tier-3 { list-style: disc !important; padding-left: 20px !important; margin: 5px 0 !important; }
.m-tier-3 li { color: #00FFFF; margin-bottom: 5px; }
</style>

<script>
function mToggle(element) {
    const content = element.nextElementSibling;
    const arrow = element.querySelector('.m-arrow');
    content.classList.toggle('is-active');
    arrow.innerHTML = content.classList.contains('is-active') ? '▲' : '▼';
}

function doMartialSearch() {
    const input = document.getElementById('martialSearch').value.toUpperCase();
    const listItems = document.querySelectorAll('.m-tier-3 li');
    listItems.forEach(li => {
        const text = li.textContent || li.innerText;
        if (text.toUpperCase().indexOf(input) > -1) {
            li.style.display = "";
            // 搜尋時自動展開分類
            li.closest('.m-content').classList.add('is-active');
        } else {
            li.style.display = "none";
        }
    });
}
</script>